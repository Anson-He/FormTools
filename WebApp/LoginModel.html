<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>多平台通用表单工具</title>
    <link rel="stylesheet"href="css/login.css">

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style type="text/css">
        a {
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div id="all">
    <div v-if="WXLogin">
        <div class="login-box" style="position: absolute; top: -10%; left: 37%">
            <p>请用微信扫描二维码登录</p>
            <img src="http://api.shinytengxvnyun.cn:55555/images/weixin/codescene1585214317966.jpg" width="300px" height="300px">
            <p></p>
            <a @click="toLogin">用其他方式登录</a>
        </div>
    </div>
    <div v-if="Login">
        <div class="login-box">
            <h1 style="color: cornflowerblue">登录</h1>
            <div class="form">
                <div class="item">
                    <input type="text" v-model="email1" placeholder="电子邮箱">
                </div>
                <div class="item">
                    <input type="password" v-model="password1" placeholder="密码">
                </div>
            </div>
            <a @click="toRegistered" style="color: black">注册</a>
            <a @click="toForgotPassword" style="color: black">找回密码</a>
            <p></p>
            <button @click="login" style="height: 40px; background-color: cornflowerblue; border: cornflowerblue; color: white; border-radius:15px;">登录</button>
            <p></p>
            <img src="http://m.qpic.cn/psc?/V112TgEJ1gE547/dc.CEbKkDpD9Z7TwDzRx593xI9uHGWjwLf2E3hf1PGyS.xH7sUrSZeiUvf91TKa6UsTOHI5o90nxydD83JYXIg!!/b&bo=AATbAwAAAAARB.w!&rf=viewer_4"
                 width="25px" height="25px"> <a @click="toWXLogin" style="color: black">微信登录</a>
            <img src="http://m.qpic.cn/psc?/V112TgEJ1gE547/7o.xLwnHK.dZGyBaILrm99KQ8ZsA8VyruXLY8T6DlWCiPsLVOOrNbl0KDGtY2LWAeZReXJn6rvf0qvMTNyXzbaDpUqezf6refzuGsP9q7zI!/b&bo=AAQABAAAAAARFyA!&rf=viewer_4"
                 width="25px" height="25px"><i>易班登录</i>
        </div>
    </div>
    <div v-if="Registered">
        <div class="login-box">
            <h1 style="color: cornflowerblue">欢迎注册</h1>
            <div class="form">
                <div class="item">
                    <input type="text" v-model="form2.nickname2" placeholder="请输入昵称">
                </div>
                <div class="item">
                    <input type="password" v-model="form2.password2" placeholder="请输入密码">
                </div>
                <div class="item">
                    <input type="text" v-model="form2.email2" placeholder="请输入邮箱">
                </div>
                <div class="item">
                    <input type="text" v-model="form2.code2" placeholder="输入验证码" style="width: 67px"> <button @click="getEmailCode2" style="width: 85px; background-color: cornflowerblue; border: cornflowerblue; color: white; border-radius:5px; height: 25px">获取验证码</button>
                </div>
                <p></p>
                <button @click="registerUser" style="height: 40px; background-color: cornflowerblue; border: cornflowerblue; color: white; border-radius:15px;">立即注册</button>
            </div>
        </div>
    </div>
    <div id="ForgotPassword">
        <div class="login-box">
            <h1 style="color: cornflowerblue">重设密码</h1>
            <div class="form">
                <div class="item">
                    <input type="text" v-model="form3.email3" placeholder="请输入邮箱">
                </div>
                <div class="item">
                    <input type="text" v-model="form3.code3" placeholder="输入验证码" style="width: 67px"><button @click="getEmailCode3" style="width: 85px; background-color: cornflowerblue; border: cornflowerblue; color: white; border-radius:5px; height: 25px">获取验证码</button>
                </div>
                <div class="item">
                    <input type="password" v-model="form3.password3" placeholder="请输入新密码">
                </div>
                <div class="item">
                    <input type="password" v-model="form3.password_again3" placeholder="再次确认密码">
                </div>
                <p></p>
                <button @click="resetPassword" style="height: 40px; background-color: cornflowerblue; border: cornflowerblue; color: white; border-radius:15px;">确认重设</button>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    //axios全局配置withCredentials也可以获取cookie
    // axios.defaults.withCredentials = true;
    var app = new Vue({
        el: '#all',
        data: {
            form1{
                email1: "",
                password1: ""
            },
            form2:{
                email2: "",
                password2: "",
                nickname2: "",
                code2: ""
            },
            form3:{
                email3:"",
                code3:"",
                password3:"",
                password_again3:""
            }
        },
        methods: {
            login: function () {
                axios.get("http://localhost:8080/login?" + "email1=" + this.form1.email1
                    + "&password1=" + this.form1.password1,
                    {
                        "withCredentials": true/*单个axios设置withCredentials*/
                    }
                ).then(function (response) {
                    if (response.data.form1.status_code === 0) {
                        alert(response.data.form1.msg);
                        console.log(response.data.form1)
                    } else {
                        alert("登录成功");
                        console.log(response);
                        window.location.href="indexxxx.html"
                    }
                }).catch(function (error) {
                    console.log(error)
                })
            },
            getEmailCode2 : function () {
                console.log(this.form2.email2);
                axios.get("http://localhost:8080/email-code?"+"email2="+this.form2.email2,{
                    "withCredentials": true
                }).then(function (response) {
                    if (response.data.form2.status_code === 0) {
                        alert(response.data.form2.msg);
                        console.log(response.data.form2)
                    } else {
                        alert("已发送验证码");
                    }
                }).catch(function (error) {
                    console.log(error)
                })
            },
            registerUser : function () {
                axios.post("http://localhost:8080/user",this.form2,{
                    "withCredentials": true
                }).then(function (response) {
                    if (response.data.form2.status_code === 0) {
                        alert(response.data.form2.msg);
                        console.log(response.data.form2)
                    } else {
                        var timer = 3;
                        alert('注册成功，点击确认'+timer+'s后返回...')
                        setTimeout(go,3000);
                        function go() {
                            location.href='Login.html'
                        }
                    }
                }).catch(function (error) {
                    console.log(error)
                })
            },
            getEmailCode3: function () {
                axios.get("http://localhost:8080/email-code/reset-password?" + "email3=" + this.form3.email3,
                    {
                        "withCredentials": true/*单个axios设置withCredentials*/
                    }
                ).then(function (response) {
                    if (response.data.form3.status_code === 0) {
                        alert(response.data.form3.msg);
                        console.log(response.data.form3)
                    } else {
                        alert("验证码发送成功");
                    }
                }).catch(function (error) {
                    console.log(error)
                })
            },
            resetPassword: function () {
                axios.post("http://localhost:8080/reset-password",this.form3,{
                    "withCredentials": true/*单个axios设置withCredentials*/
                }).then(function (response) {
                    if (response.data.form3.status_code === 0) {
                        alert(response.data.form3.msg);
                        console.log(response.data.form3)
                    } else {
                        alert("密码修改成功");
                        window.location.href="login.html"
                    }
                }).catch(function (error) {
                    console.log(error)
                })
            }
        }
    })
</script>
<script>
    var click = new vue({
        el: '#all',
        data: {
            WXLogin:true,
            Login:false,
            Registered:false,
            ForgotPassword:false
            },
        methods: {
            toWXLogin:function () {
                this.WXLogin=true,
                this.Login=false,
                this.Registered=false,
                this.ForgotPassword=false
            },
            toLogin:function () {
                this.WXLogin=false,
                this.Login=true,
                this.Registered=false,
                this.ForgotPassword=false
            },
            toRegistered:function () {
                this.WXLogin=false,
                this.Login=false,
                this.Registered=true,
                this.ForgotPassword=false
            },
            toForgotPassword:function () {
                this.WXLogin=false,
                this.Login=false,
                this.Registered=false,
                this.ForgotPassword=true
            }
        }
    })
</script>
</html>